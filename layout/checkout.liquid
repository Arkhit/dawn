<!DOCTYPE html>
<html lang="{{ locale }}" dir="{{ direction }}" class="{{ checkout_html_classes }}">
  <head>
    {%- assign production_shop_id = 60429828153 -%}
    {%- assign staging_shop_id    = 67711828243 -%}

    {%- case shop.id -%}
    {%- when production_shop_id -%}
      {%- assign google_tag_manager_container_id = 'GTM-5H85H3N' -%}
    {%- when staging_shop_id -%}
      {%- assign google_tag_manager_container_id = 'GTM-TG2KSNK' -%}
    {%- endcase %}

    {%- unless google_tag_manager_container_id == blank -%}
      <!-- Google Tag Manager -->
      <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','{{ google_tag_manager_container_id }}');</script>
      <!-- End Google Tag Manager -->
    {%- endunless -%}

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, height=device-height, minimum-scale=1.0, user-scalable=0">
    <meta name="referrer" content="origin">

    <title>{{ page_title }}</title>

    {{ content_for_header }}

    {{ checkout_stylesheets }}
    {{ checkout_scripts }}

    {% render 'shogun-head' %}
  </head>
  <body>
    {%- unless google_tag_manager_container_id == blank -%}
      <!-- Google Tag Manager (noscript) -->
      <noscript><iframe src="https://www.googletagmanager.com/ns.html?id={{ google_tag_manager_container_id }}"
      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
      <!-- End Google Tag Manager (noscript) -->
    {%- endunless -%}

    {{ skip_to_content_link }}

    <header class="banner" data-header role="banner">
    </header>

    {{ order_summary_toggle }}
    <div class="content" data-content>
      <div class="wrap">
        <div class="main">
          <header class="main__header" role="banner">
            <a class="logo" href="https://inventables.com/">{{ 'rebranded-inv-logo.png' | asset_url | img_tag: 'Logo' }}</a>
            {{ breadcrumb }}
            {{ alternative_payment_methods }}
          </header>
          <main class="main__content" role="main"">
            {{ content_for_layout }}
          </main>
          <footer class="main__footer" role="contentinfo">
            window.onload = updateContact;
            {{ content_for_footer }}
          </footer>
        </div>
        <aside class="sidebar" role="complementary">
          <div class="sidebar__header">
            <a class="logo" href="https://inventables.com/">{{ 'rebranded-inv-logo.png' | asset_url | img_tag: 'Logo' }}</a>
          </div>
          <div class="sidebar__content">
            {{ content_for_order_summary }}
          </div>
        </aside>
      </div>
    </div>

    {{ tracking_code }}

    <script>
      (function($) {
        if (typeof window.dataLayer === "undefined") {
          return;
        }

        $(document).on("page:load page:change", function() {
          {% comment %}
            TODO:
            - [ ] Test Gift Card items - they appear to have no sku
            - [ ] Sometimes the "contact_information" is skipped,
                  in which case the begin_checkout event won't be recorded
            - [ ] X-Carves (and possibly other products) are represented differently:
                  X-Carves are now a single item with sku 30686-07(M|D), whereas before
                  Shopify we listed all the items that make up an X-Carve
            - [ ] Check what happens in skus_comma_separated when a line_item has no SKU
          {% endcomment %}

          {%- assign skus_comma_separated = checkout.line_items | map: "sku" | uniq | sort | join: "," -%}

          if (Shopify.Checkout.step === "contact_information") {
            {% render "google-data-layer-ecommerce-begin-checkout", skus: skus_comma_separated %}
          }

          if (Shopify.Checkout.step === "payment_method") {
            {% if checkout.requires_shipping %}
              {% render "google-data-layer-ecommerce-add-shipping-info", skus: skus_comma_separated %}
            {% endif %}
          }

          if (Shopify.Checkout.page === "thank_you") {
            {% render "google-data-layer-ecommerce-purchase", skus: skus_comma_separated %}
          }
        });
      })(Checkout.$);
    </script>
  </body>
</html>
