{% assign variants = product.variants %}

<h3>Currently under construction, we're very sorry!</h3>

{% if variants.size > 1 %}
  <div class="variant-swatches">
    {% for variant in variants %}
      {% assign primary_color = variant.metafields.custom.primarycolor %}
      {% assign secondary_color = variant.metafields.custom.secondarycolor %}

      {% if primary_color and secondary_color %}
        <label for="variant-{{ variant.id }}" class="swatch-label">
          <input
            type="radio"
            name="{{ product_form_id }}[id]"
            id="variant-{{ variant.id }}"
            value="{{ variant.id }}"
            {% if variant.id == product.selected_or_first_available_variant.id %}
              checked
            {% endif %}
          >
          <div class="swatch" style="position: relative;">
            <!-- First Half -->
            <div
              class="swatch-half swatch-half-1"
              style="
                width: 50%;
                height: 100%;
                background-color: {{ primary_color }};
                position: absolute;
                top: 0;
                left: 0;
                clip-path: polygon(0 0, 100% 0, 0 100%);
              "
            ></div>
            <!-- Second Half -->
            <div
              class="swatch-half swatch-half-2"
              style="
                width: 50%;
                height: 100%;
                background-color: {{ secondary_color }};
                position: absolute;
                top: 0;
                right: 0;
                clip-path: polygon(100% 0, 100% 100%, 0 100%);
              "
            ></div>
          </div>
        </label>
      {% endif %}
    {% endfor %}
  </div>

  <script>
    // JavaScript to update the variant when a swatch is clicked
    document.addEventListener('DOMContentLoaded', function () {
      const swatchInputs = document.querySelectorAll('.variant-swatches input[type="radio"]');
      swatchInputs.forEach((input) => {
        input.addEventListener('change', (event) => {
          const productForm = event.target.closest('form');
          if (productForm) {
            productForm.submit();
          } else {
            console.warn('No product form found!');
          }
        });
      });
    });
  </script>

  <style>
    .variant-swatches {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .swatch-label {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      position: relative;
      width: 30px;
      height: 30px;
      cursor: pointer;
    }

    .swatch-label input[type='radio'] {
      position: absolute;
      width: 100%;
      height: 100%;
      opacity: 0;
      cursor: pointer;
    }

    .swatch {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      border: 1px solid #ccc;
      position: relative;
      overflow: hidden;
    }

    /* For debugging purposes - visible borders */
    .swatch-half {
      width: 100%;
      height: 100%;
    }
  </style>
{% endif %}
