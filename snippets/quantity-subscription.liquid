<style>
  .make-subscription {
    display: block;
    margin-bottom: 10px;
  }
  .hidden-element {
    display: none !important;
  }
  .product-form__input > #tabheadings > label {
    background-color: rgba(0,0,0,0);
    border-radius: unset;
    padding: 1rem;
    border: none !important;
  }

  #oncelabel {
    color: rgba(17,17,17,0.5);
    margin-bottom: 0;
  }

  #subslabel {
    color: rgba(0,0,0,1);
    margin-bottom: 0;
  }


  .product-form__input > #tabheadings > input:checked + label {
    opacity: 1;
    background-color: #fbf9f7;
  }
  label svg {
    height: 17px;
  }

  #quantity-subscription-body {
    background-color: #fbf9f7;
    width: 100%;
    padding: 5%;
  }

  quantity-input {
    background-color: #ffffff;
  }

  .qs-flex {
    display: flex;
  }
  .qs-row {
    flex-direction: row;
  }
  .qs-jc-fs {
    justify-content: flex-start;
  }
  .qs-ai-c {
    align-items: center;
  }
  .qs-w-100p {
    width: 100%;
    max-width: unset;
  }
  .hidden-vis {
    visibility: hidden;
  }
  .product-form__input #subscription input[type="radio"] + label {
    border: 0.1rem solid rgba(var(--color-foreground),0.55);
    background-color: #888888;
    border-radius: 0.5rem;
  }
  .product-form__input #subscription input[type="radio"] + label p {
    color: rgb(var(--color-background));
  }
  .product-form__input #subscription input[type="radio"]:checked + label {
    background-color: rgb(var(--color-background));
  }
  .product-form__input #subscription input[type="radio"]:checked + label p {
    color: rgb(var(--color-foreground));
  }
  #subscription-btn-wrapper button {
    color: #000000;
    background-color: #ffcc00;
    border: none;
    box-shadow: none;
  }
  #subscription-btn-wrapper button:hover {
    background: #ffd940;
  }
</style>
{% if curr_variant.metafields.global.subscriptions.value.size > 0 %}
  <div class="product-form__input product-form__subscription qs-w-100p" {{ block.shopify_attributes }}>
    <div class="qs-flex qs-row qs-jc-fs qs-ai-c" id="tabheadings">
      <input type="radio" value="once" name="mode" id="once" checked><label for="once" class="checked" id="oncelabel">Einzelkauf</label>
      <input type="radio" value="subs" name="mode" id="subs"><label for="subs" id="subslabel">Sparabo</label>
    </div>
    <div id="quantity-subscription-body">
      <div id="quantity-wrapper" class="flex column">
        {%- for price in curr_variant.metafields.global.prices.value -%}
          <div class="w-100p flex row jc-spb ai-c py-4 px-4">
            <img src="{{ product.featured_image | img_url: '100x' }}" alt="{{ product.featured_image.alt | escape }}" width="50" height="50" loading="lazy">
            <p>{{ price.quantity }} {% if price.quantity == 1 %}Packung{% else %}Packungen{% endif %}</p>
            <p>{{ price.cost | money_without_currency }} €</p>
          </div>
        {%- endfor-%}
        <quantity-input class="quantity" id="quantity-input">
          <button class="quantity__button no-js-hidden" name="minus" type="button">
            <span class="visually-hidden">{{ 'products.product.quantity.decrease' | t: product: product.title | escape }}</span>
              {% render 'icon-minus' %}
          </button>
          <input class="quantity__input"
            type="number"
            name="quantity"
            id="Quantity-{{ section.id }}"
            min="1"
            value="1"
            form="product-form-{{ section.id }}"
          >
          <button class="quantity__button no-js-hidden" name="plus" type="button">
            <span class="visually-hidden">{{ 'products.product.quantity.increase' | t: product: product.title | escape }}</span>
            {% render 'icon-plus' %}
          </button>
        </quantity-input>
      </div>
    <div class="subscription hidden-element flex column" id="subscription">
      {%- for sub in curr_variant.metafields.global.subscriptions.value -%}
        <input type="radio" value="{{ forloop.index0 }}" name="subscription" id="sub-{{ forloop.index0 }}"{% if forloop.index0 == 0 %} checked{% endif %}><label for="sub-{{ forloop.index0 }}"><div><p>alle {{ sub.period }} Tage</p><p>{{ sub.cost | money_without_currency }} €</p></div></label>
      {%- endfor -%}
    </div>
    </div>
  </div>
{% else %}
  <div class="product-form__input product-form__quantity" {{ block.shopify_attributes }}>
    <label class="form__label" for="Quantity-{{ section.id }}">
      {{ 'products.product.quantity.label' | t }}
    </label>

    <quantity-input class="quantity">
      <button class="quantity__button no-js-hidden" name="minus" type="button">
        <span class="visually-hidden">{{ 'products.product.quantity.decrease' | t: product: product.title | escape }}</span>
        {% render 'icon-minus' %}
      </button>
      <input class="quantity__input"
          type="number"
          name="quantity"
          id="Quantity-{{ section.id }}"
          min="1"
          value="1"
          form="product-form-{{ section.id }}"
        >
      <button class="quantity__button no-js-hidden" name="plus" type="button">
        <span class="visually-hidden">{{ 'products.product.quantity.increase' | t: product: product.title | escape }}</span>
        {% render 'icon-plus' %}
      </button>
    </quantity-input>
  </div>
  {% endif %}
</div>
<div {{ block.shopify_attributes }} id="subscription-btn-wrapper" class="hidden-element">
  <div>
    <a href="https://abo.schlafdrink.de/cart/{{ curr_variant.metafields.global.subscriptions.value[0].vid | escape }}:1" class="make-subscription nodec" id="subscription-link">
      <button
        type="button"
        class="button button--full-width"
      >
        Abonnement abschließen
      </button>
    </a>
  </div>
</div>
<script>
  function changeButtons() {
    if(document.getElementById("once").checked) {
      document.getElementById("subscription-btn-wrapper").classList.add("hidden-element")
      document.getElementById("buy-buttons").classList.remove("hidden-element")
      document.getElementById("quantity-wrapper").classList.remove("hidden-element")
      document.getElementById("subscription").classList.add("hidden-element")
      document.getElementById("oncelabel").classList.add("checked")
      document.getElementById("subslabel").classList.remove("checked")
    }
    if(document.getElementById("subs").checked) {
      document.getElementById("subscription-btn-wrapper").classList.remove("hidden-element")
      document.getElementById("buy-buttons").classList.add("hidden-element")
      document.getElementById("quantity-wrapper").classList.add("hidden-element")
      document.getElementById("subscription").classList.remove("hidden-element")
      document.getElementById("oncelabel").classList.remove("checked")
      document.getElementById("subslabel").classList.add("checked")
    }
  }
  function changeLink(e) {
    const subscriptions = {{ curr_variant.metafields.global.subscriptions.value | json }}
    const checkedValue = Number(e.target.value)
    const vid = subscriptions[checkedValue].vid
    const url = `https://abo.schlafdrink.de/cart/${vid}:1`
    document.getElementById("subscription-link").href = url
  }
  document.querySelectorAll("input[name='mode']").forEach(element => element.addEventListener("change",changeButtons))
  document.querySelectorAll("input[name='subscription']").forEach(element => element.addEventListener("change", changeLink))
</script>