{%-liquid
  if section.settings.title == 'ingredientes'
	  assign fields = product.metafields.Ingredientes.TituloContenido
  endif

  if section.settings.title == 'instrucciones'
    assign fields = product.metafields.InstruccionesUso.TituloContenido
  endif
-%}
 
{% for field in fields %}
  {% if forloop.first %}
    {%- if section.settings.title == 'ingredientes' -%}
      {%- liquid
        assign section_title            = product.metafields.Ingredientes.TituloSeccion
        assign show_title               = product.metafields.Ingredientes.MostrarTitulo
        assign section_subtitle         = product.metafields.Ingredientes.DescripcionSeccion
        assign setting_title            = product.metafields.Ingredientes.TituloContenido
        assign setting_text             = product.metafields.Ingredientes.DescripcionContenido
        assign setting_image            = product.metafields.Ingredientes.ImagenContenido
      -%}
      {%- capture ButtonText -%} {{ 'belevels.slideshow.show_more' | t }} {{ section_title }} {%- endcapture -%}
    {%- endif -%}
    {%- liquid
      if section.settings.title == 'instrucciones'
        assign section_title            = product.metafields.InstruccionesUso.TituloSeccion
        assign show_title               = product.metafields.InstruccionesUso.MostrarTitulo
        assign section_subtitle         = product.metafields.InstruccionesUso.DescripcionSeccion
        assign setting_title            = product.metafields.InstruccionesUso.TituloContenido
        assign setting_text             = product.metafields.InstruccionesUso.DescripcionContenido
        assign setting_image            = product.metafields.InstruccionesUso.ImagenContenido

        assign ButtonText               = product.metafields.InstruccionesUso.PreguntaSeccion
        assign section_answer           = product.metafields.InstruccionesUso.RespuestaSeccion
        assign section_includes         = product.metafields.InstruccionesUso.IncluyeSeccion
        assign section_indications      = product.metafields.InstruccionesUso.IndicacionesSeccion
      endif
        assign count                    = forloop.length | minus: 1
        assign slideId                  = section_title | camelcase
    -%}

    {{ 'section-multicolumn.css' | asset_url | stylesheet_tag }}      

    {%- style -%}
      .section-{{ section.id }}-padding {
        padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
        padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
      }
  
      @media screen and (min-width: 750px) {
        .section-{{ section.id }}-padding {
          padding-top: {{ section.settings.padding_top }}px;
          padding-bottom: 0;
        }
      }            
    {%- endstyle -%}
  
    {%- liquid
      assign columns_mobile_int = section.settings.columns_mobile | plus: 0
      assign show_mobile_slider = false
      if count > columns_mobile_int
        assign show_mobile_slider = true
      endif
    -%}
  
    <div class="multicolumn {% if section.settings.layout == 'grid' %} page-width{% endif %} color-{{ section.settings.color_scheme }} gradient{% unless section.settings.background_style == 'none' and settings.text_boxes_border_thickness > 0 or settings.text_boxes_shadow_opacity > 0 %} background-{{ section.settings.background_style }}{% endunless %}{% if section.settings.title == blank %} no-heading{% endif %}">
      <div class="{% if section.settings.layout == 'full_bleed' %} no-gutters page-width{% endif %} section-{{ section.id }}-padding isolate">

        <div class="title-wrapper--self-padded-mobile title-wrapper--no-top-margin section-title text-center">
          {%- if section_title and show_title -%}
            <h2 class="title mx-auto {{ section.settings.heading_size }}">
              {{ section_title | escape }}
            </h2>
          {%- endif -%}
          {%- if section_subtitle -%}
            <div class="subtitle--medium text-center">{{ section_subtitle | escape }}</div>
          {%- endif -%}
            <div class="swiper-button-next next-{{ slideId }}">{% render 'icon-arrow' %}</div>
            <div class="swiper-button-prev prev-{{ slideId }} rotate-180">{% render 'icon-arrow' %}</div>
        </div>

        <!-- Start Slide -->
        <div id="slider-{{ slideId }}" class="swiper slider-gutter{% if section.settings.layout == 'grid' %} page-width{% endif %}" {% comment %}role="region" aria-roledescription="{{ 'sections.slideshow.carousel' | t }}" aria-label="{{ section_title | escape }}"{% endcomment %}>
          <div class="swiper-wrapper">
            {%- liquid
              assign highest_ratio = 0
              for i in (0..count)
                assign content_image_aspect_ratio = 1
                if content_image_aspect_ratio > highest_ratio
                  assign highest_ratio = content_image_aspect_ratio
                endif
              endfor
            -%}
            {%- for i in (0..count) -%}
              {%- liquid
                assign content_image = setting_image[i]
                assign content_title = setting_title[i]
                assign content_text  = setting_text[i]
              -%}            
              <div class="swiper-slide multicolumn-list__item{% if section.settings.column_alignment == 'center' %} center{% endif %}">
                {%- if content_image != blank -%}
                  {% if section.settings.image_ratio == 'adapt' or section.settings.image_ratio == 'circle' %}
                    {% assign spaced_image = true %}
                  {% endif %}
                {%- endif -%}                      
                <div class="multicolumn-card content-container slide-effect-01">
                  <div class="multicolumn-card__image-wrapper multicolumn-card__image-wrapper--{{ section.settings.image_width }}-width{% if section.settings.image_width != 'full' or spaced_image %} multicolumn-card-spacing{% endif %}">
                    <div class="media media--transparent media--{{ section.settings.image_ratio }}" {% if section.settings.image_ratio == 'adapt' %} style="padding-bottom: {{ 1 | divided_by: highest_ratio | times: 100 }}%;"{% endif %}>
                      <img
                        class="image"
                        src="{{ content_image }} 550w"
                        data-src="{{ content_image }}"
                        data-widths="[275, 550, 710, 1420]"
                        data-aspectratio="{{ content_image_aspect_ratio }}"
                        sizes="(min-width: 990px) {% if count <= 2 %}710px{% else %}550px{% endif %},
                          (min-width: 750px) {% if count == 1 %}710px{% else %}550px{% endif %},
                          calc(100vw - 30px)"
                        alt="{{ content_title }}"
                      >
                    </div>
                  </div>                    
                  <div class="multicolumn-card__info">
                    {%- if content_title != blank -%}
                      <h3 class="title h2">{{ content_title | escape }}</h3>
                    {%- endif -%}
                    {%- if content_text != blank -%}
                      <div class="rte">{{ content_text }}</div>
                    {%- endif -%}
                  </div>
                </div>
              </div>
            {%- endfor -%}
          </div>
        </div>        
      </div>
      <div class="swiper-pagination pagination-{{ slideId }}"></div>
      <!-- Start Popup -->
      {%- if ButtonText -%}
        <modal-opener class="product-popup-modal__opener no-js-hidden quick-add-hidden d-block text-center" data-modal="#PopupModal-{{ slideId }}" {{ block.shopify_attributes }}>
            <button id="ProductPopup-{{ slideId }}" class="button animate-arrow" type="button" aria-haspopup="dialog">
              {{ ButtonText }}
              <span class="icon-wrap rotate--45">&nbsp;{% render 'icon-arrow' %}</span>
            </button>
        </modal-opener>
        <a href="" class="product-popup-modal__button link no-js">{{ ButtonText }}</a>
      {%- endif -%}
      <!-- End   Popup -->            

    </div>
    <!-- Initialize Swiper -->
    <script>
      let swiper{{ slideId }} = new Swiper("#slider-{{ slideId }}", {
        speed: {{ section.settings.change_slides_speed }} * 1000,
        slidesPerView: {{ section.settings.columns_mobile }},
        spaceBetween: {{ section.settings.change_slides_space_right }},
        centeredSlides: true,
        freeMode: false,
        loop: true,
        rewind: false,
        watchSlidesProgress: true,
        grabCursor: true,
        {%- if section.settings.auto_rotate == true -%}
          autoplay: {
            delay: 2500,
            disableOnInteraction: false,
            waitForTransition: true,
            pauseOnMouseEnter: true,
          },
        {%- endif -%}
        pagination: {
          el: ".pagination-{{ slideId }}",
          clickable: true,
        },
        navigation: {
          nextEl: ".next-{{ slideId }}",
          prevEl: ".prev-{{ slideId }}",
        },
        breakpoints: {
          640: {
            slidesPerView: {{ section.settings.columns_mobile }},
          },
          768: {
            slidesPerView: 2,
          },
          1024: {
            slidesPerView: {{ section.settings.columns_desktop }},
          },
        },
      });
    </script>
  {% endif %}
{% endfor %}
  
<!-- Start Popup -->
{%- if ButtonText -%}
  {%- if section.settings.title == 'ingredientes' -%}
    {%- for field in product.metafields.Ingredientes.TituloIngredienteSecund -%}
      {%- if forloop.first -%}
        {%- liquid
          assign ing-sec-title = product.metafields.Ingredientes.TituloIngredienteSecund
          assign ing-sec-desc  = product.metafields.Ingredientes.DescripcionIngredienteSecund
          assign count         = forloop.length | minus: 1
        -%}
        <modal-dialog id="PopupModal-{{ slideId }}" class="product-popup-modal" {{ block.shopify_attributes }}>
          <div role="dialog" aria-label="{{ ButtonText }}" aria-modal="true" class="product-popup-modal__content h-100" tabindex="-1">
            <button id="ModalClose-{{ slideId }}" type="button" class="product-popup-modal__toggle" aria-label="{{ 'accessibility.close' | t }}">{% render 'icon-close' %}</button>
            <div class="product-popup-modal__content-info">
              {% for i in (0..count) %}
                {% assign ingSecondaryTitle       = ing-sec-title[i] | strip %}
                {% assign ingSecondaryDescription = ing-sec-desc[i] | strip %}

                <div class="modal-content">
                  <h3 class="h2 font-body-bold">
                    <span class="icon icon-custom">{% render 'icon-checkmark' %}</span>{{ ingSecondaryTitle | escape }}
                  </h3> 
                  <p>{{ ingSecondaryDescription | escape }}</p>
                </div>
              {% endfor %}
            </div>
          </div>
        </modal-dialog>
      {% endif %}
    {% endfor %}
  {% endif %}
  
  {%- if section.settings.title == 'instrucciones' -%}
    <modal-dialog id="PopupModal-{{ slideId }}" class="product-popup-modal" {{ block.shopify_attributes }}>
      <div role="dialog" aria-label="{{ ButtonText }}" aria-modal="true" class="product-popup-modal__content h-100" tabindex="-1">
        <button id="ModalClose-{{ slideId }}" type="button" class="product-popup-modal__toggle" aria-label="{{ 'accessibility.close' | t }}">{% render 'icon-close' %}</button>
        <div class="product-popup-modal__content-info">
          {%- if section_answer -%}
            <div class="modal-content">
              {{ section_answer }}
            </div>
          {%- endif -%}
          {%- if section_includes -%}
            <div class="modal-content">
              {{ section_includes }}
            </div>
          {%- endif -%}
          {%- if section_indications -%}
            <div class="modal-content">
              {{ section_indications }}
            </div>
        {%- endif -%}
        </div>
      </div>
    </modal-dialog>    
  {% endif %}
{% endif %}
<!-- End   Popup -->            

  {% schema %}
  {
    "name": "Ingredientes/Inst.",
    "class": "section",
    "tag": "section",
    "settings": [
      {
        "type": "select",
        "id": "title",
        "options": [
          {
            "value": "ingredientes",
            "label": "Ingredientes principales"
          },
          {
            "value": "instrucciones",
            "label": "Instrucciones de uso"
          }
        ],
        "default": "ingredientes",
        "label": "Información a mostrar"
      },
      {
        "type": "select",
        "id": "heading_size",
        "options": [
          {
            "value": "h2",
            "label": "t:sections.all.heading_size.options__1.label"
          },
          {
            "value": "h1",
            "label": "t:sections.all.heading_size.options__2.label"
          },
          {
            "value": "h0",
            "label": "t:sections.all.heading_size.options__3.label"
          }
        ],
        "default": "h1",
        "label": "t:sections.all.heading_size.label"
      },
      {
        "type": "select",
        "id": "layout",
        "options": [
          {
            "value": "full_bleed",
            "label": "t:sections.slideshow.settings.layout.options__1.label"
          },
          {
            "value": "grid",
            "label": "t:sections.slideshow.settings.layout.options__2.label"
          }
        ],
        "default": "full_bleed",
        "label": "t:sections.slideshow.settings.layout.label"
      },
      {
        "type": "select",
        "id": "image_width",
        "options": [
          {
            "value": "third",
            "label": "t:sections.multicolumn.settings.image_width.options__1.label"
          },
          {
            "value": "half",
            "label": "t:sections.multicolumn.settings.image_width.options__2.label"
          },
          {
            "value": "full",
            "label": "t:sections.multicolumn.settings.image_width.options__3.label"
          }
        ],
        "default": "third",
        "label": "t:sections.multicolumn.settings.image_width.label"
      },
      {
        "type": "select",
        "id": "image_ratio",
        "options": [
          {
            "value": "adapt",
            "label": "t:sections.multicolumn.settings.image_ratio.options__1.label"
          },
          {
            "value": "portrait",
            "label": "t:sections.multicolumn.settings.image_ratio.options__2.label"
          },
          {
            "value": "square",
            "label": "t:sections.multicolumn.settings.image_ratio.options__3.label"
          },
          {
            "value": "circle",
            "label": "t:sections.multicolumn.settings.image_ratio.options__4.label"
          }
        ],
        "default": "circle",
        "label": "t:sections.multicolumn.settings.image_ratio.label"
      },
      {
        "type": "range",
        "id": "columns_desktop",
        "min": 1,
        "max": 6,
        "step": 1,
        "default": 3,
        "label": "t:sections.multicolumn.settings.columns_desktop.label"
      },
      {
        "type": "select",
        "id": "column_alignment",
        "options": [
          {
            "value": "left",
            "label": "t:sections.multicolumn.settings.column_alignment.options__1.label"
          },
          {
            "value": "center",
            "label": "t:sections.multicolumn.settings.column_alignment.options__2.label"
          }
        ],
        "default": "center",
        "label": "t:sections.multicolumn.settings.column_alignment.label"
      },
      {
        "type": "select",
        "id": "background_style",
        "options": [
          {
            "value": "none",
            "label": "t:sections.multicolumn.settings.background_style.options__1.label"
          },
          {
            "value": "primary",
            "label": "t:sections.multicolumn.settings.background_style.options__2.label"
          }
        ],
        "default": "primary",
        "label": "t:sections.multicolumn.settings.background_style.label"
      },
      /*
      {
        "type": "text",
        "id": "button_label",
        "default": "Button label",
        "label": "t:sections.multicolumn.settings.button_label.label"
      },
      {
        "type": "url",
        "id": "button_link",
        "label": "t:sections.multicolumn.settings.button_link.label"
      },
      */
      {
        "type": "select",
        "id": "color_scheme",
        "options": [
          {
            "value": "accent-1",
            "label": "t:sections.all.colors.accent_1.label"
          },
          {
            "value": "accent-2",
            "label": "t:sections.all.colors.accent_2.label"
          },
          {
            "value": "background-1",
            "label": "t:sections.all.colors.background_1.label"
          },
          {
            "value": "background-2",
            "label": "t:sections.all.colors.background_2.label"
          },
          {
            "value": "inverse",
            "label": "t:sections.all.colors.inverse.label"
          }
        ],
        "default": "background-1",
        "label": "t:sections.all.colors.label"
      },
      {
        "type": "header",
        "content": "t:sections.multicolumn.settings.header_mobile.content"
      },
      {
        "type": "select",
        "id": "columns_mobile",
        "options": [
          {
            "value": "1",
            "label": "t:sections.multicolumn.settings.columns_mobile.options__1.label"
          },
          {
            "value": "2",
            "label": "t:sections.multicolumn.settings.columns_mobile.options__2.label"
          }
        ],
        "default": "1",
        "label": "t:sections.multicolumn.settings.columns_mobile.label"
      },
      /*{
        "type": "checkbox",
        "id": "swipe_on_mobile",
        "default": false,
        "label": "t:sections.multicolumn.settings.swipe_on_mobile.label"
      },*/
      {
        "type": "header",
        "content": "t:sections.all.padding.section_padding_heading"
      },
      {
        "type": "range",
        "id": "padding_top",
        "min": 0,
        "max": 100,
        "step": 4,
        "unit": "px",
        "label": "t:sections.all.padding.padding_top",
        "default": 36
      },
      {
        "type": "range",
        "id": "padding_bottom",
        "min": 0,
        "max": 100,
        "step": 4,
        "unit": "px",
        "label": "t:sections.all.padding.padding_bottom",
        "default": 36
      },
      {
        "type": "checkbox",
        "id": "auto_rotate",
        "label": "t:sections.slideshow.settings.auto_rotate.label",
        "default": true
      },
      {
        "type": "range",
        "id": "change_slides_speed",
        "min": 1,
        "max": 9,
        "step": 0.5,
        "unit": "s",
        "label": "t:sections.slideshow.settings.change_slides_speed.label",
        "default": 2.5
      },
      {
        "type": "range",
        "id": "change_slides_space_right",
        "min": 0,
        "max": 100,
        "step": 5,
        "unit": "px",
        "label": "Espacio entre diapositivas (derecha)",
        "default": 10
      },
      {
        "type": "select",
        "id": "slider_visual",
        "options": [
          {
            "value": "dots",
            "label": "t:sections.slideshow.settings.slider_visual.options__2.label"
          },
          {
            "value": "counter",
            "label": "t:sections.slideshow.settings.slider_visual.options__1.label"
          },
          {
            "value": "numbers",
            "label": "t:sections.slideshow.settings.slider_visual.options__3.label"
          }
        ],
        "default": "dots",
        "label": "t:sections.slideshow.settings.slider_visual.label"
      }
    ],
    "presets": [
      {
        "name": "Slider Ingredientes/Instrucciones"
      }
    ]
  }
  {% endschema %}