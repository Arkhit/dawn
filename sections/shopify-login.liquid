{{ 'customer.css' | asset_url | stylesheet_tag }}
{{ 'customer_inventables.css' | asset_url | stylesheet_tag }}

<div class="login-container">
  <div class="inventables__shopify-login__flash-message">
    You are being redirected to login.
    <span id="redirect" style="display: none">Click <a class="link link--text" href="">here</a> if you are not redirected.</span>
  </div>

  <div id="login" class="inventables__shopify-login" style="border: none; height: 0px; width: 0px;"></div>
</div>
<script type="text/javascript">
  window.addEventListener("DOMContentLoaded", () => {
    let loginDiv = document.getElementById("login");
    let loginForm = document.createElement("iframe");
    loginForm.style = "border: none;";
    loginForm.id="inventables";

    let searchParams = new URLSearchParams(window.location.search);
    let iframeSource = "{{ shop.metafields.development.local_address }}/shopify/logout?" + searchParams.toString();
    loginForm.setAttribute("src", iframeSource);
    loginDiv.appendChild(loginForm);
  });

  window.addEventListener("message", (event) => {
    if (event.origin === "{{ shop.metafields.development.local_address }}") {
      var data = JSON.parse(event.data);
      window.location.href = data.target_url;
      let redirect = document.getElementById('redirect');
      redirect.style.removeProperty('display');
      redirect.querySelector('a').href = data.target_url;
    }
  });
</script>
